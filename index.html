
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Utmatic Modular</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; background: #f9f9f9; }
    .tab-bar { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .tab { padding: 0.5rem 1rem; background: #eee; border: none; cursor: pointer; }
    .tab.active { font-weight: bold; background: #ddd; }
    .tab-content { display: none; }
    .tab-content.active { display: block; background: white; padding: 1rem; border-radius: 6px; border: 1px solid #ccc; max-width: 640px; }
    .field-group { margin-bottom: 1.25rem; }
    .field-group label { display: block; font-weight: 600; margin-bottom: 0.25rem; }
    .field-group input[type="text"],
    .field-group input[type="file"],
    .field-group select { width: 100%; padding: 0.5rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 4px; }
    .checkbox-wrapper { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.25rem; }
    .form-actions { margin-top: 1.5rem; }
    .file-list { position: absolute; right: 2rem; top: 2rem; background: white; padding: 1rem; border: 1px solid #ccc; border-radius: 6px; }
    .file-list ul { list-style: none; padding: 0; margin: 0.5rem 0; }
    .file-list li { margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <h1>Utmatic</h1>
  <p>Equip your documents with tracking links â€” <em>instantly.</em></p>
  <div class="tab-bar">
    <button id="add-tab" class="tab">+ New document</button>
  </div>
  <div id="tab-contents"></div>

  <div class="file-list">
    <strong>File List</strong>
    <ul id="file-list"></ul>
    <button id="process-btn" disabled>Process PDFs</button>
  </div>

  <script>
    const formFields = [
      { id: "pdf", label: "Upload PDF", type: "file" },
      { id: "job_type", label: "Job Type", type: "select", options: [
        { value: "", label: "Select one" },
        { value: "utm_only", label: "Add UTM Only" },
        { value: "links_and_utm", label: "Add Links and UTM" }
      ]},
      { id: "target_format", label: "Target Format", type: "text" },
      { id: "base_url", label: "Base URL", type: "text" },
      { id: "utm_source", label: "UTM Source", type: "text" },
      { id: "utm_medium", label: "UTM Medium", type: "text" },
      { id: "utm_campaign", label: "UTM Campaign", type: "text" },
      { id: "filename", label: "Document Name", type: "text", placeholder: "MyFileName" },
      { id: "underline", label: "Add underline to links?", type: "checkbox" }
    ];

    let docCount = 1;
    const tabBar = document.querySelector(".tab-bar");
    const tabContents = document.getElementById("tab-contents");
    const fileList = document.getElementById("file-list");
    const processBtn = document.getElementById("process-btn");

    document.getElementById("add-tab").addEventListener("click", createTab);

    function setActiveTab(tabId) {
      document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
      document.querySelectorAll(".tab-bar .tab").forEach(t => t.classList.remove("active"));
      document.querySelector(`.tab-content#${tabId}`)?.classList.add("active");
      document.querySelector(`.tab-bar .tab[data-tab="${tabId}"]`)?.classList.add("active");
    }

    function updateFileListStatus(tabId, name, saved) {
      const item = fileList.querySelector(`[data-tab="${tabId}"]`);
      item.textContent = name || "Untitled Document";
      item.style.color = saved ? "green" : "orange";
      processBtn.disabled = ![...fileList.children].every(li => li.style.color === "green");
    }

    function renderFormFields(form) {
      formFields.forEach(field => {
        let wrapper;

        if (field.type === "checkbox") {
          wrapper = document.createElement("div");
          wrapper.className = "checkbox-wrapper";
          const input = document.createElement("input");
          input.type = "checkbox";
          input.name = field.id;
          input.id = field.id;
          const label = document.createElement("label");
          label.htmlFor = field.id;
          label.textContent = field.label;
          wrapper.appendChild(input);
          wrapper.appendChild(label);
        } else {
          wrapper = document.createElement("div");
          wrapper.className = "field-group";
          const label = document.createElement("label");
          label.htmlFor = field.id;
          label.textContent = field.label;
          let input;
          if (field.type === "select") {
            input = document.createElement("select");
            field.options.forEach(opt => {
              const option = document.createElement("option");
              option.value = opt.value;
              option.textContent = opt.label;
              input.appendChild(option);
            });
          } else {
            input = document.createElement("input");
            input.type = field.type;
            if (field.placeholder) input.placeholder = field.placeholder;
          }
          input.name = field.id;
          input.id = field.id;
          wrapper.appendChild(label);
          wrapper.appendChild(input);
        }

        form.appendChild(wrapper);
      });

      const submit = document.createElement("button");
      submit.type = "submit";
      submit.textContent = "Save";
      submit.className = "form-actions";
      form.appendChild(submit);
    }

    function createTab() {
      const tabId = `doc-${docCount}`;
      const tabBtn = document.createElement("button");
      tabBtn.className = "tab";
      tabBtn.innerHTML = `Document ${docCount} <span style="color:red; cursor:pointer; margin-left:8px;" title="Delete" class="delete-tab" data-tab="${tabId}">&times;</span>`;
      tabBtn.dataset.tab = tabId;
      tabBtn.addEventListener("click", () => setActiveTab(tabId));
      tabBar.appendChild(tabBtn);

      const tabContent = document.createElement("div");
      tabContent.className = "tab-content";
      tabContent.id = tabId;
      const form = document.createElement("form");
      renderFormFields(form);

      form.addEventListener("submit", e => {
        e.preventDefault();
        const name = form.filename?.value || "Document " + docCount;
        updateFileListStatus(tabId, name, true);
      });

      const filenameInput = form.querySelector("input[name='filename']");
      filenameInput.addEventListener("input", () => {
        tabBtn.textContent = filenameInput.value || "Document " + docCount;
        updateFileListStatus(tabId, filenameInput.value, false);
      });

      tabContent.appendChild(form);
      tabContents.appendChild(tabContent);

      const listItem = document.createElement("li");
      listItem.dataset.tab = tabId;
      fileList.appendChild(listItem);
      updateFileListStatus(tabId, "", false);

      setActiveTab(tabId);
      docCount++;
    }

    createTab(); // load initial tab

    // Delegate deletion of document tabs and their forms
    document.addEventListener("click", function(e) {
      if (e.target.classList.contains("delete-tab")) {
        const tabId = e.target.dataset.tab;
        const tab = document.querySelector(`[data-tab="${tabId}"]`);
        const content = document.getElementById(tabId);
        const fileItem = document.querySelector(`.file-list [data-tab="${tabId}"]`);
        if (tab) tab.remove();
        if (content) content.remove();
        if (fileItem) fileItem.remove();

        // Activate the last available tab
        const lastTab = document.querySelector(".tab-bar .tab:last-of-type");
        if (lastTab) {
          const newTabId = lastTab.dataset.tab;
          setActiveTab(newTabId);
        }
      }
    });
  </script>
</body>
</html>
